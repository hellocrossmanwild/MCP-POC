# MCP Proof of Concept Spec

## What we're proving

1. MCP server queries a database and returns structured data
2. Claude Desktop renders that data as interactive artifacts
3. Only Google-authenticated users on an allowed list can access it

## The stack

- **Database:** Replit PostgreSQL
- **MCP Server:** TypeScript + @modelcontextprotocol/sdk
- **Auth:** Google OAuth 2.1 + email allowlist in the database
- **Hosting:** Replit

Everything lives in one Replit project.

---

## Database

### Table 1: contractors

```sql
CREATE TABLE contractors (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  initials TEXT NOT NULL,
  title TEXT NOT NULL,
  bio TEXT,
  location TEXT NOT NULL,
  day_rate INTEGER NOT NULL,
  years_experience INTEGER NOT NULL,
  availability TEXT NOT NULL CHECK (availability IN ('available', 'within_30', 'unavailable')),
  available_from DATE,
  certifications TEXT[] NOT NULL DEFAULT '{}',
  sectors TEXT[] NOT NULL DEFAULT '{}',
  skills TEXT[] NOT NULL DEFAULT '{}',
  rating NUMERIC(2,1),
  review_count INTEGER DEFAULT 0,
  placement_count INTEGER DEFAULT 0,
  security_clearance TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_contractors_location ON contractors (location);
CREATE INDEX idx_contractors_availability ON contractors (availability);
CREATE INDEX idx_contractors_certifications ON contractors USING GIN (certifications);
CREATE INDEX idx_contractors_sectors ON contractors USING GIN (sectors);
```

### Table 2: allowed_users

```sql
CREATE TABLE allowed_users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  name TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

Two tables. One for the data, one for who's allowed in.

---

## Auth flow

1. User adds MCP server URL in Claude Desktop
2. Claude Desktop reads server metadata, sees OAuth is required
3. Google sign-in popup appears
4. User logs in with their Google account
5. MCP server receives Google OAuth token
6. Server decodes token, extracts email address
7. Server checks email against `allowed_users` table
8. If found: access granted, tool calls work
9. If not found: access denied

To give someone access: insert their email into `allowed_users`.
To revoke: delete it.

### MCP server auth metadata

The server advertises Google OAuth in its discovery response:

```json
{
  "name": "contractor-search",
  "version": "1.0.0",
  "auth": {
    "type": "oauth2",
    "authorization_url": "https://accounts.google.com/o/oauth2/v2/auth",
    "token_url": "https://oauth2.googleapis.com/token",
    "client_id": "YOUR_GOOGLE_CLIENT_ID",
    "scopes": ["openid", "email", "profile"]
  }
}
```

### Server-side validation middleware

```typescript
async function validateUser(token: string): Promise<boolean> {
  // Decode Google token to get user email
  const googleUser = await verifyGoogleToken(token);
  
  if (!googleUser?.email) {
    return false;
  }
  
  // Check against allowlist
  const result = await db.query(
    'SELECT email FROM allowed_users WHERE email = $1',
    [googleUser.email]
  );
  
  return result.rows.length > 0;
}
```

Every MCP tool call goes through this check before executing.

---

## MCP tools

### Tool 1: search_contractors

```typescript
{
  name: "search_contractors",
  description: "Search for contractors by location, availability, certifications, sectors, or free text. Returns matching contractors with full profile data.",
  inputSchema: {
    type: "object",
    properties: {
      query: {
        type: "string",
        description: "Free text search across name, title, bio, skills"
      },
      location: {
        type: "string",
        description: "Filter by location e.g. 'London', 'Manchester'"
      },
      availability: {
        type: "string",
        enum: ["available", "within_30", "any"],
        description: "Filter by availability"
      },
      certifications: {
        type: "array",
        items: { type: "string" },
        description: "Required certifications e.g. ['ISO 27001']"
      },
      max_rate: {
        type: "number",
        description: "Maximum day rate in GBP"
      },
      limit: {
        type: "number",
        description: "Results to return. Default 5."
      }
    }
  }
}
```

Returns:

```json
{
  "total_matches": 14,
  "showing": 5,
  "contractors": [
    {
      "id": "uuid",
      "name": "Sarah Chen",
      "initials": "SC",
      "title": "Senior Compliance Auditor",
      "bio": "12 years in financial services compliance...",
      "location": "London",
      "day_rate": 575,
      "years_experience": 12,
      "availability": "available",
      "certifications": ["ISO 27001 Lead Auditor", "CREST", "GDPR Practitioner"],
      "sectors": ["Banking", "Insurance", "Fintech"],
      "skills": ["ISO 27001", "GDPR", "FCA Compliance"],
      "rating": 4.8,
      "review_count": 23,
      "placement_count": 47,
      "security_clearance": "SC Cleared"
    }
  ]
}
```

### Tool 2: get_contractor

```typescript
{
  name: "get_contractor",
  description: "Get full profile for a specific contractor by ID.",
  inputSchema: {
    type: "object",
    properties: {
      id: { type: "string", description: "Contractor UUID" }
    },
    required: ["id"]
  }
}
```

Returns single contractor with all fields.

---

## Seed data

50 contractors. Three sectors:

**Financial Services (20):** ISO 27001, CREST, CISSP, SOC 2, GDPR, PCI DSS. London heavy. £450-700/day.

**Healthcare / Public Sector (15):** ISO 27001, Cyber Essentials Plus, DSPT, GDPR. Spread across UK. £400-600/day.

**Technology (15):** ISO 27001, SOC 2, CISSP, CISM, AWS Security. London and Manchester. £500-800/day.

60% available now. 25% within 30 days. 15% unavailable.
Ratings 3.8 to 5.0. Experience 3 to 20 years.

---

## Demo script

**Connect:** Add MCP server URL in Claude Desktop. Google sign-in popup. Log in. Done.

**Search:** "Show me available contractors in London" → Claude renders candidate cards.

**Filter:** "Just the ones with ISO 27001 under £600/day" → Filtered results.

**Profile:** "Tell me more about [name]" → Full profile view.

**Auth proof:** "Without being on the allowed list, this returns nothing."

**The closer:** "This is dummy data. Your contractor database, your methodology, accessible through Claude. That's what £15K builds."

---

## Google OAuth setup

1. Go to Google Cloud Console
2. Create a new project (or use existing)
3. Enable Google Identity / OAuth consent screen
4. Create OAuth 2.0 credentials (Web application)
5. Set redirect URI to your Replit MCP server callback URL
6. Copy Client ID and Client Secret into Replit environment variables

---

## Build order

1. Create Replit project (Node/TypeScript)
2. Set up Replit PostgreSQL, create tables, seed data
3. Build MCP server with two tools
4. Add Google OAuth middleware
5. Test in Claude Desktop

**Total: 1 day.**
